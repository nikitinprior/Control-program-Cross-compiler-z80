# Control-program-Cross-compiler-z80
New control program —Åross-compiler HiTech C v3.09

The HiTech C v3.09 compiler control program for CP/M is adapted for use as a cross-compiler control program for running on Linux or MacOS operating systems or as a compiler control program for the Unix-like operating system UZI-180.

The source code of the zc3.c control program is based on the native version of the HiTech C v3.09 compiler for CP/M.

The new control program uses all the options available in the original program.

The new version has new additional features.

By default, the program compiles files for the UZI-180 operating system.

When linking, a library with standard functions and a runtime initialization module for the UZI-180 operating system are used. The executable file generated by the compiler is given a name without an extension.

To create programs for the CP/M operating system, use the "-CPM" option. In this case, a library with standard functions and a runtime initialization module for the CP/M operating system will be used. The output executable will have a .com extension.

When compiling for CP/M, the predefined macro "CPM" is available, while when compiling for UZI-180, the predefined macro "UZI" is used. In addition to these macros, the "HI_TECH_C" and "z80" macros are available by default in both modes.

The control program can specify the name of the output executable file. other than the default. A different name can be given with the "-Ename" option, which is compatible with the version supported by Tony Nicholson. https://github.com/agn453/HI-TECH-Z80-C 

With the "-H" option, you can display the options supported by the new compiler control program on the screen. Unlike the Tony Nicholson version, the help is built into the program and does not require an external file.

The compiler control program in the first pass uses a new version of the preprocessor that can process C++-style comments.

The names of the programs that execute the different compilation passes have been changed from the names in the original version. The letter '3' has been added to the end of the name, which reduces the chance that the names will coincide with programs previously installed on the computer.

Like the version of a similar program HiTech C for UNIX v4.11, when you enter only the zc3 command without parameters, the new control program does not display a prompt and does not wait for commands, but displays a message

  Options and files to compile are not specified. Use zc3 -h for help.

and completes its work.

In all other respects, the new version of the control program works in the same way as the original program for CP/M.

The programs cref and objtohex are rarely used. Until their source code is fully reconstructed in C, code related to the operation of these programs in the source code of the zc3.c control program is blocked from compilation using conditional compilation directives. The "-A" and "-CR" options are not available at the moment, but most of the functionality is available in full.

Cross-compiler pass programs for Linux, MacOS or Windows operating systems created from recovered C code can handle larger source code. Unlike the HiTech C v3.09 compiler for CP/M, the cross-compiler manages to optimize all functions of all compiler programs and generates executable files for both CP/M and UZI-180.

After defining the environment variables INCDIR80, LIBDIR80 and PATH, in any current directory, you can compile your source programs using the zc3 cross-compiler control program with the necessary options and a list of processed programs. From this point on, the zxcc emulation program is no longer required, although it can be used to check the operation of the cross compiler and run the CP/M executable programs created with it. For the normal operation of zc3, the programs of the remaining passes compiled from the restored C code are needed. They must be in the directory that is described in the PATH environment variable.

To create a control program the cross-compiler zc3 for Linux or MacOS use the command:

        gcc -O2 -o zc3 zc3.c

To create a control program compiler zc3 for UZI-180:

        zc3 -O -ozc3 zc3.c execvp.c mktemp.c

An executable file for UZI-180 is being created, but it has not yet been tested on real hardware.


# Acknowledgments
Thank you to HI-TECH SOFTWARE for writing the Hi-Tech C v3.09 compiler for CP/M and allowing free use of it.

Thanks to John Elliott for writing the zxcc emulator. It was mostly used to compile the reconstructed source code.

Thanks to Hector Peraza for adapting the UZI-180 operating system to the P112 microcomputer, which made me want to restore the source code of the Hi-Tech C V3.09 compiler. UZI-180 can be obtained from the repository https://github.com/hperaza/UZI180. 

I express my gratitude to all the people who participated in restoring the source code of Hi-Tech C compiler V3.09, testing its restored versions and reporting on the bugs found, especially Mark Ogden. His contribution was the greatest, greatly speeding up the recovery process and giving it an almost professional level. The experience of working with Mark has left me with indelible feelings, added to my knowledge and experience. I am very grateful to him for the opportunity to work together.

Individual thanks to Tony Nicholson for saving materials about the Hi-Tech C v3.09 compiler for CP/M, to Michal Tomek and Fred Weigel for providing information about detected bugs and to Ladislau Szilagyi for his contributions to improving the compiler programs and writing the new macro assembler for Hi-Tech C V3.09.

I am grateful to all the unnamed people who cared enough to restore and preserve information about this wonderful compiler and the CP/M operating system.

I apologize if I forgot to mention anyone.

Andrey Nikitin 21-07-2022.
